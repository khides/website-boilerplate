---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import Breadcrumb from '../../../components/Breadcrumb.astro';
import { useTranslations } from '../../../i18n/utils';
import { getCollection, render, type CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog', ({ id }: { id: string }) => id.startsWith('en/'));
  return posts.map((post) => ({
    params: { slug: post.slug.replace('en/', '') },
    props: { post },
  }));
}

interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;
const { Content } = await render(post);
const t = useTranslations('en');

const breadcrumbItems = [
  { label: t.blog.title, href: '/en/blog' },
  { label: post.data.title },
];
---

<BaseLayout
  title={`${post.data.title} | ${t.site.title}`}
  description={post.data.description}
  type="article"
  publishedDate={post.data.pubDate}
  modifiedDate={post.data.updatedDate}
  tags={post.data.tags}
  pageType="blogPost"
>
  <article class="py-20">
    <div class="mx-auto max-w-3xl px-6">
      <Breadcrumb items={breadcrumbItems} />

      <!-- Header -->
      <header class="mb-8">
        <div class="mb-4 flex items-center gap-4 text-sm text-slate-500 dark:text-slate-400">
          <time datetime={post.data.pubDate.toISOString()}>
            {
              post.data.pubDate.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
              })
            }
          </time>
          {
            post.data.tags && post.data.tags.length > 0 && (
              <div class="flex gap-2">
                {post.data.tags.map((tag: string) => (
                  <span class="rounded bg-blue-100 px-2 py-0.5 text-xs text-blue-500 dark:bg-blue-900 dark:text-blue-400">
                    {tag}
                  </span>
                ))}
              </div>
            )
          }
        </div>
        <h1 class="mb-4 text-3xl font-bold text-slate-800 dark:text-white md:text-4xl">
          {post.data.title}
        </h1>
        <p class="text-lg text-slate-500 dark:text-slate-400">{post.data.description}</p>
      </header>

      <!-- Content -->
      <div class="prose prose-lg max-w-none dark:prose-invert">
        <Content />
      </div>

      <!-- Back Link -->
      <div class="mt-12 border-t border-slate-200 pt-8 dark:border-slate-700">
        <a href="/en/blog" class="text-blue-500 hover:underline">
          ‚Üê {t.blog.backToList}
        </a>
      </div>
    </div>
  </article>
</BaseLayout>
