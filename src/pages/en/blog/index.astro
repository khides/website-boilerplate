---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { useTranslations } from '../../../i18n/utils';
import { getCollection } from 'astro:content';

const t = useTranslations('en');

const allPosts = await getCollection('blog', ({ id, data }) =>
  id.startsWith('en/') && !data.draft
);
const posts = allPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<BaseLayout title={`${t.blog.title} | ${t.site.title}`} pageType="blog">
  <div class="py-20">
    <div class="mx-auto max-w-3xl px-6">
      <!-- Header -->
      <header class="mb-12 text-center">
        <h1 class="mb-4 text-4xl font-bold text-slate-800 dark:text-white">
          {t.blog.title}
        </h1>
        <p class="text-slate-500 dark:text-slate-400">{t.blog.subtitle}</p>
      </header>

      <!-- Posts -->
      <div class="space-y-6">
        {
          posts.length > 0 ? (
            posts.map((post) => (
              <article class="rounded-lg bg-slate-50 p-6 dark:bg-slate-800">
                <div class="mb-2 flex items-center gap-4 text-sm text-slate-500 dark:text-slate-400">
                  <time datetime={post.data.pubDate.toISOString()}>
                    {post.data.pubDate.toLocaleDateString('en-US', {
                      year: 'numeric',
                      month: 'long',
                      day: 'numeric',
                    })}
                  </time>
                  {post.data.tags && post.data.tags.length > 0 && (
                    <div class="flex gap-2">
                      {post.data.tags.slice(0, 2).map((tag) => (
                        <span class="rounded bg-blue-100 px-2 py-0.5 text-xs text-blue-500 dark:bg-blue-900 dark:text-blue-400">
                          {tag}
                        </span>
                      ))}
                    </div>
                  )}
                </div>
                <h2 class="mb-2 text-xl font-bold text-slate-800 dark:text-white">
                  <a
                    href={`/en/blog/${post.slug.replace('en/', '')}`}
                    class="transition-colors hover:text-blue-500"
                  >
                    {post.data.title}
                  </a>
                </h2>
                <p class="mb-4 text-slate-500 dark:text-slate-400">{post.data.description}</p>
                <a
                  href={`/en/blog/${post.slug.replace('en/', '')}`}
                  class="text-sm font-medium text-blue-500 hover:underline"
                >
                  {t.blog.readMore} â†’
                </a>
              </article>
            ))
          ) : (
            <p class="text-center text-slate-500 dark:text-slate-400">{t.blog.noPosts}</p>
          )
        }
      </div>
    </div>
  </div>
</BaseLayout>
