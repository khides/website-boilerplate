---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { useTranslations } from '../../i18n/utils';
import { Icon } from 'astro-icon/components';

const t = useTranslations('ja');
---

<BaseLayout title={`${t.contact.title} | ${t.site.title}`} pageType="contact">
  <div class="py-20">
    <div class="mx-auto max-w-2xl px-6">
      <!-- Header -->
      <header class="mb-12 text-center">
        <h1 class="mb-4 text-4xl font-bold text-slate-800 dark:text-white">
          {t.contact.title}
        </h1>
        <p class="text-slate-500 dark:text-slate-400">{t.contact.description}</p>
      </header>

      <!-- Contact Form -->
      <div class="mb-12 rounded-lg bg-slate-50 p-8 dark:bg-slate-800">
        <!-- TODO: Google FormのアクションURLを更新してください -->
        <form
          action="https://docs.google.com/forms/d/e/YOUR_FORM_ID/formResponse"
          method="POST"
          target="_blank"
          class="space-y-6"
        >
          <!-- Honeypot field for spam protection -->
          <input
            type="text"
            name="_gotcha"
            class="honeypot-field"
            tabindex="-1"
            autocomplete="off"
            aria-hidden="true"
          />

          <div>
            <label for="name" class="mb-2 block text-sm font-medium text-slate-800 dark:text-white">{t.contact.form.name}</label>
            <input
              type="text"
              id="name"
              name="entry.1707691043"
              placeholder="山田 太郎"
              required
              maxlength="100"
              class="w-full rounded-lg border border-slate-300 bg-white px-4 py-3 text-slate-800 focus:border-blue-500 focus:outline-none dark:border-slate-600 dark:bg-slate-900 dark:text-white"
            />
          </div>

          <div>
            <label for="email" class="mb-2 block text-sm font-medium text-slate-800 dark:text-white">{t.contact.form.email}</label>
            <input
              type="email"
              id="email"
              name="emailAddress"
              placeholder="your@email.com"
              required
              maxlength="254"
              class="w-full rounded-lg border border-slate-300 bg-white px-4 py-3 text-slate-800 focus:border-blue-500 focus:outline-none dark:border-slate-600 dark:bg-slate-900 dark:text-white"
            />
          </div>

          <div>
            <label for="subject" class="mb-2 block text-sm font-medium text-slate-800 dark:text-white">{t.contact.form.subject}</label>
            <select
              id="subject"
              name="entry.154271175"
              required
              class="w-full rounded-lg border border-slate-300 bg-white px-4 py-3 text-slate-800 focus:border-blue-500 focus:outline-none dark:border-slate-600 dark:bg-slate-900 dark:text-white"
            >
              <option value="お問い合わせ">お問い合わせ</option>
              <option value="ご相談">ご相談</option>
              <option value="その他">その他</option>
            </select>
          </div>

          <div>
            <label for="message" class="mb-2 block text-sm font-medium text-slate-800 dark:text-white">{t.contact.form.message}</label>
            <textarea
              id="message"
              name="entry.654761272"
              rows="5"
              placeholder="詳細をご記入ください"
              required
              minlength="10"
              maxlength="5000"
              class="w-full rounded-lg border border-slate-300 bg-white px-4 py-3 text-slate-800 focus:border-blue-500 focus:outline-none dark:border-slate-600 dark:bg-slate-900 dark:text-white"
            ></textarea>
          </div>

          <button type="submit" class="btn-primary w-full">
            {t.contact.form.submit}
          </button>
        </form>
      </div>

      <!-- Social Links -->
      <!-- TODO: ソーシャルリンクを更新してください -->
      <div class="text-center">
        <p class="mb-4 text-slate-500 dark:text-slate-400">SNSでもご連絡いただけます</p>
        <div class="flex justify-center gap-4">
          <a
            href="https://github.com/your-username"
            target="_blank"
            rel="noopener noreferrer"
            class="rounded-lg bg-slate-50 p-3 text-slate-500 transition-colors hover:text-blue-500 dark:bg-slate-800 dark:text-slate-400 dark:hover:text-blue-400"
            aria-label="GitHub"
          >
            <Icon name="lucide:github" class="h-6 w-6" />
          </a>
          <a
            href="https://x.com/your-handle"
            target="_blank"
            rel="noopener noreferrer"
            class="rounded-lg bg-slate-50 p-3 text-slate-500 transition-colors hover:text-blue-500 dark:bg-slate-800 dark:text-slate-400 dark:hover:text-blue-400"
            aria-label="X (Twitter)"
          >
            <Icon name="lucide:twitter" class="h-6 w-6" />
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Form rate limiting script -->
  <script>
    (function () {
      const COOLDOWN_MS = 30000;
      const MIN_FILL_TIME = 3000;
      const STORAGE_KEY = 'lastFormSubmit';

      document.addEventListener('DOMContentLoaded', function () {
        const form = document.querySelector('form[action*="google.com/forms"]');
        if (!form) return;

        const loadTime = Date.now();

        form.addEventListener('submit', function (e) {
          const now = Date.now();

          if (now - loadTime < MIN_FILL_TIME) {
            e.preventDefault();
            return false;
          }

          const lastSubmit = localStorage.getItem(STORAGE_KEY);
          if (lastSubmit && now - parseInt(lastSubmit) < COOLDOWN_MS) {
            e.preventDefault();
            const remaining = Math.ceil((COOLDOWN_MS - (now - parseInt(lastSubmit))) / 1000);
            alert('送信間隔が短すぎます。' + remaining + '秒後に再試行してください。');
            return false;
          }

          localStorage.setItem(STORAGE_KEY, now.toString());
        });
      });
    })();
  </script>
</BaseLayout>
